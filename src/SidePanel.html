<!-- src/SidePanel.html
<html>
  <body style="width:100%; height:100%; margin:0;">
    <div>Side Panel</div>
    <button id="start-activity">Launch Main Stage</button>

    <script src="https://anjalirawat09.github.io/meet-addons/dist/main.bundle.js"></script>
    <script>
      // Initialize the addon and attach click listener
      document.addEventListener('DOMContentLoaded', () => {
        meetAddon.setUpAddon();
      });
    </script>
  </body>
</html> -->



<!-- <html>
<head>
  <title>Meet add-on Side Panel</title>
  <script src="https://anjalirawat09.github.io/meet-addons/dist/main.bundle.js"></script>
</head>

<body style="width: 100%; height: 100%; margin: 0">
  <div>This is the add-on Side Panel. Only you can see this.</div>
  <button id="start-activity">Launch Activity in Main Stage.</button>

  <script>
    document.body.onload = () => {
      // Library name (helloWorld) is defined in the webpack config.
      // The function (setUpAddon) is defined in main.js.
      helloWorld.setUpAddon();

      //  Log when your side panel button is clicked
      const startBtn = document.getElementById("start-activity");
      if (startBtn) {
        startBtn.addEventListener("click", () => {
          console.log("Launch Activity button clicked");
        });
      }

      //Log when Google Meet's own buttons are clicked (like Leave, Present)
      const meetButtons = document.querySelectorAll(".VYBDae-Bz112c-RLmnJb");
      meetButtons.forEach(button => {
        button.addEventListener("click", () => {
          console.log("A Google Meet button (class .VfPpkd-vQzf8d) was clicked");
        });
      });
    };
  </script>
</body>
</html> -->


<!-- <html>
<head>
  <title>Meet add-on Side Panel</title>
  <script src="https://anjalirawat09.github.io/meet-addons/dist/main.bundle.js"></script>
</head>

<body style="width: 100%; height: 100%; margin: 0">
  <div>This is the add-on Side Panel. Only you can see this.</div>
  
  Buttons
  <button id="start-activity">Launch Activity in Main Stage</button>
  <button id="open-passive">Open Passive Referral</button>

  <script>
    document.body.onload = async () => {
      const { session, sidePanelClient } = await helloWorld.setUpAddon();

      // ✅ Get meeting info
      const meetingInfo = await sidePanelClient.getMeetingInfo();

      // ✅ Construct the Meet URL manually
      const meetUrl = `https://meet.google.com/${meetingInfo.meetingCode}`;

      console.log("Current Meet URL:", meetUrl, "MeetingInfo:", meetingInfo);

      // Passive Referral button
      const passiveBtn = document.getElementById("open-passive");
      if (passiveBtn) {
        passiveBtn.addEventListener("click", () => {
          const targetUrl = `https://passivereferral.com/?meetUrl=${encodeURIComponent(meetUrl)}`;
          console.log("Opening Passive Referral with:", targetUrl);
          window.open(targetUrl, "_blank");
        });
      }
    };
  </script>
</body>
</html> -->




<html>
<head>
  <title>Meet add-on Side Panel</title>
  <script src="https://anjalirawat09.github.io/meet-addons/dist/main.bundle.js"></script>
  <style>
    body {
      width: 100%;
      height: 100%;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: #f9f9f9;
      font-family: Arial, sans-serif;
    }

    #submit-feedback {
      background-color: #6a0dad; /* Purple */
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    #submit-feedback:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }

    #submit-feedback:hover:enabled {
      background-color: #580b9e; /* Darker purple */
    }
  </style>
</head>

<body>
  <button id="submit-feedback">Submit Feedback</button>

  <script>
    document.body.onload = async () => {
      const { session, sidePanelClient } = await helloWorld.setUpAddon();
      const feedbackBtn = document.getElementById("submit-feedback");

      // Get the event_id from URL query param
      const urlParams = new URLSearchParams(window.location.search);
      const eventId = urlParams.get("eventId");
      if (!eventId) {
        feedbackBtn.disabled = true;
        feedbackBtn.innerText = "Event ID not found";
        return;
      }

      try {
        // Call your Django API to get host and event details
        const response = await fetch('http://192.168.4.101:8005/meeting/get_meeting_host/', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ event_id: eventId })
        });

        const data = await response.json();
        if (!data.organizer_email) {
          feedbackBtn.disabled = true;
          feedbackBtn.innerText = "Host info not available";
          return;
        }

        const currentUserEmail = session?.user?.email;

        // Disable for attendees
        if (!currentUserEmail || currentUserEmail !== data.organizer_email) {
          feedbackBtn.disabled = true;
          feedbackBtn.innerText = "Only host can submit feedback";
          return;
        }

        // Host-only functionality
        feedbackBtn.addEventListener("click", () => {
          const targetUrl = `https://passivereferral.com/?meetUrl=${encodeURIComponent(data.hangout_link)}&eventId=${eventId}`;
          window.open(targetUrl, "_blank");
        });

      } catch (err) {
        console.error("Error fetching host info:", err);
        feedbackBtn.disabled = true;
        feedbackBtn.innerText = "Error loading host info";
      }
    };
  </script>
</body>
</html>
